{"version":3,"file":"basis.js","sources":["../../../node_modules/tslib/tslib.es6.js","../src/Basis.ts","../src/TranscoderWorkerWrapper.ts","../src/TranscoderWorker.ts","../src/BasisLoader.ts","../src/index.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { TYPES } from '@pixi/constants';\nimport { INTERNAL_FORMATS } from '@pixi/compressed-textures';\n\n/**\n * The transcoding formats provided by basis_universal.\n *\n * NOTE: Not all of these formats are supported on WebGL!\n *\n * @ignore\n */\n/* eslint-disable camelcase */\nexport enum BASIS_FORMATS {\n    cTFETC1 = 0,\n    cTFETC2 = 1,\n    cTFBC1 = 2,\n    cTFBC3 = 3,\n    cTFBC4 = 4,\n    cTFBC5 = 5,\n    cTFBC7 = 6,\n    cTFPVRTC1_4_RGB = 8,\n    cTFPVRTC1_4_RGBA = 9,\n    cTFASTC_4x4 = 10,\n    cTFATC_RGB = 11,\n    cTFATC_RGBA_INTERPOLATED_ALPHA = 12,\n    cTFRGBA32 = 13,\n    cTFRGB565 = 14,\n    cTFBGR565 = 15,\n    cTFRGBA4444 = 16,\n}\n/* eslint-enable camelcase */\n\n/**\n * Maps {@link BASIS_FORMATS} to {@link PIXI.INTERNAL_FORMATS}\n *\n * @ignore\n */\nexport const BASIS_FORMAT_TO_INTERNAL_FORMAT: { [id: number]: INTERNAL_FORMATS } = {\n    [BASIS_FORMATS.cTFETC1]: INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL,\n    [BASIS_FORMATS.cTFBC1]: INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT,\n    [BASIS_FORMATS.cTFBC3]: INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,\n    [BASIS_FORMATS.cTFPVRTC1_4_RGB]: INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,\n    [BASIS_FORMATS.cTFPVRTC1_4_RGBA]: INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,\n    [BASIS_FORMATS.cTFATC_RGB]: INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL,\n    [BASIS_FORMATS.cTFASTC_4x4]: INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL\n};\n\n/**\n * Maps {@link BASIS_FORMATS} to {@link PIXI.TYPES}. These formats are a fallback when the basis file cannot be transcoded\n * to a valid compressed texture format.\n *\n * NOTE: {@link BASIS_FORMATS.cTFBGR565} is not supported, while {@link BASIS_FORMATS.cTFRGBA4444} is not implemented by\n *  [at]pixi/basis.\n *\n * @ignore\n */\nexport const BASIS_FORMAT_TO_TYPE: { [id: number]: TYPES } = {\n    [BASIS_FORMATS.cTFRGBA32]: TYPES.UNSIGNED_BYTE,\n    [BASIS_FORMATS.cTFRGB565]: TYPES.UNSIGNED_SHORT_5_6_5,\n    [BASIS_FORMATS.cTFRGBA4444]: TYPES.UNSIGNED_SHORT_4_4_4_4\n};\n\n/**\n * Maps {@link PIXI.INTERNAL_FORMATS} to {@link BASIS_FORMATS}\n *\n * @ignore\n */\nexport const INTERNAL_FORMAT_TO_BASIS_FORMAT: { [id: number]: number }\n    = (Object.keys(BASIS_FORMAT_TO_INTERNAL_FORMAT) as string[])\n        .map((key: string) => Number(key))\n        .reduce((reverseMap: any, basisFormat: any) =>\n        {\n            reverseMap[(BASIS_FORMAT_TO_INTERNAL_FORMAT as any)[basisFormat]] = basisFormat;\n\n            return reverseMap;\n        }, {});\n\n/**\n * Enumerates the basis formats with alpha components\n *\n * @ignore\n */\nexport const BASIS_FORMATS_ALPHA: { [id: number]: boolean } = {\n    [BASIS_FORMATS.cTFBC3]: true,\n    [BASIS_FORMATS.cTFPVRTC1_4_RGBA]: true,\n    [BASIS_FORMATS.cTFASTC_4x4]: true\n};\n\n/**\n * Binding to C++ {@code BasisFile} wrapper class.\n *\n * @see https://github.com/BinomialLLC/basis_universal/blob/master/webgl/transcoder/basis_wrappers.cpp\n * @ignore\n */\nexport declare class BasisFile\n{\n    constructor(buffer : Uint8Array);\n    getNumImages(): number;\n    getNumLevels(imageId: number): number;\n    getImageWidth(imageId: number, level: number): number;\n    getImageHeight(imageId: number, level: number): number;\n    getHasAlpha(): boolean;\n    startTranscoding(): boolean;\n    getImageTranscodedSizeInBytes(\n        imageId : number,\n        level: number,\n        basisFormat: number): number;\n    transcodeImage(dstBuff: Uint8Array,\n        imageId: number,\n        level: number,\n        basisFormat: BASIS_FORMATS,\n        pvrtcWrapAddressing: boolean,\n        getAlphaForOpaqueFormats: boolean): number;\n    close(): void;\n    delete(): void;\n}\n\n// Missing typings? - https://github.com/microsoft/TypeScript/issues/39655\n/**\n * Compressed texture extensions relevant to the formats into which Basis can decompress into.\n *\n * @ignore\n */\n/* eslint-disable camelcase */\nexport type BasisTextureExtensions = {\n    s3tc?: WEBGL_compressed_texture_s3tc,\n    s3tc_sRGB: WEBGL_compressed_texture_s3tc_srgb,\n    etc: any,\n    etc1: any,\n    pvrtc: any,\n    atc: any,\n    astc: WEBGL_compressed_texture_astc\n};\n/* eslint-enable camelcase */\n\n/**\n * API provided by basis_universal WebGL library.\n *\n * @ignore\n */\nexport type BasisBinding = {\n    BasisFile: typeof BasisFile,\n    initializeBasis(): void\n};\n\n/**\n * Binding to basis_universal WebGL library.\n *\n * @see https://github.com/BinomialLLC/basis_universal/blob/master/webgl/transcoder/build/basis_transcoder.js\n * @ignore\n */\nexport type BASIS = (opts?: { wasmBinary: ArrayBuffer }) => Promise<BasisBinding>;\n","import type { BASIS, BASIS_FORMATS, BasisBinding } from './Basis';\n\n/**\n * Initialization message sent by the main thread.\n *\n * @ignore\n */\nexport interface IInitializeTranscoderMessage {\n    wasmSource: ArrayBuffer;\n    type: 'init';\n}\n\n/**\n * Request parameters for transcoding basis files. It only supports transcoding all of the basis file at once.\n *\n * @ignore\n */\nexport interface ITranscodeMessage\n{\n    requestID?: number;\n    rgbFormat: number;\n    rgbaFormat?: number;\n    basisData?: Uint8Array;\n    type: 'transcode';\n}\n\n/**\n * @ignore\n */\nexport interface ITranscodedImage {\n    imageID: number;\n    levelArray: Array<{\n        levelID: number,\n        levelWidth: number,\n        levelHeight: number,\n        levelBuffer: Uint8Array\n    }>;\n    width: number;\n    height: number;\n}\n\n/**\n * Response format for {@link TranscoderWorker}.\n *\n * @ignore\n */\nexport interface ITranscodeResponse {\n    type: 'init' | 'transcode';\n    requestID?: number;\n    success: boolean;\n    basisFormat?: BASIS_FORMATS;\n    imageArray?: Array<{\n        imageID: number,\n        levelArray: Array<{\n            levelID: number,\n            levelWidth: number,\n            levelHeight: number,\n            levelBuffer: Uint8Array\n        }>,\n        width: number,\n        height: number\n    }>;\n}\n\ndeclare global {\n    interface Window {\n        BASIS: BASIS;\n    }\n}\n\n/**\n * This wraps the transcoder web-worker functionality; it can be converted into a string to get the source code. It expects\n * you to prepend the transcoder JavaScript code so that the `BASIS` namespace is available.\n *\n * The transcoder worker responds to two types of messages: \"init\" and \"transcode\". You must always send the first \"init\"\n * {@link IInitializeTranscoderMessage} message with the WebAssembly binary; if the transcoder is successfully initialized,\n * the web-worker will respond by sending anothor {@link ITranscodeResponse} message with `success: true`.\n *\n * @ignore\n */\nexport function TranscoderWorkerWrapper(): void\n{\n    let basisBinding: BasisBinding;\n\n    const messageHandlers = {\n        init: (message: IInitializeTranscoderMessage): ITranscodeResponse =>\n        {\n            if (!self.BASIS)\n            {\n                console.warn('jsSource was not prepended?');\n\n                return {\n                    type: 'init',\n                    success: false\n                };\n            }\n\n            self.BASIS({ wasmBinary: message.wasmSource }).then((basisLibrary) =>\n            {\n                basisLibrary.initializeBasis();\n                basisBinding = basisLibrary;\n\n                (self as any).postMessage({\n                    type: 'init',\n                    success: true\n                });\n            });\n\n            return null;\n        },\n        transcode(message: ITranscodeMessage): ITranscodeResponse\n        {\n            const basisData = message.basisData;\n            const BASIS = basisBinding;\n\n            const data = basisData;\n            const basisFile = new BASIS.BasisFile(data);\n            const imageCount = basisFile.getNumImages();\n            const hasAlpha = basisFile.getHasAlpha();\n\n            const basisFormat = hasAlpha\n                ? message.rgbaFormat\n                : message.rgbFormat;\n            const basisFallbackFormat = 14;// BASIS_FORMATS.cTFRGB565 (cannot import values into web-worker!)\n            const imageArray = new Array(imageCount);\n\n            let fallbackMode = false;\n\n            if (!basisFile.startTranscoding())\n            {\n                basisFile.close();\n                basisFile.delete();\n\n                return {\n                    type: 'transcode',\n                    requestID: message.requestID,\n                    success: false,\n                    imageArray: null\n                };\n            }\n\n            for (let i = 0; i < imageCount; i++)\n            {\n                const levels = basisFile.getNumLevels(i);\n                const imageResource: ITranscodedImage = {\n                    imageID: i,\n                    levelArray: new Array<{\n                        levelID: number,\n                        levelWidth: number,\n                        levelHeight: number,\n                        levelBuffer: Uint8Array\n                    }>(),\n                    width: null,\n                    height: null\n                };\n\n                for (let j = 0; j < levels; j++)\n                {\n                    const format = !fallbackMode ? basisFormat : basisFallbackFormat;\n\n                    const width = basisFile.getImageWidth(i, j);\n                    const height = basisFile.getImageHeight(i, j);\n                    const byteSize = basisFile.getImageTranscodedSizeInBytes(i, j, format);\n\n                    const alignedWidth = (width + 3) & ~3;\n                    const alignedHeight = (height + 3) & ~3;\n\n                    // Level 0 is texture's actual width, height\n                    if (j === 0)\n                    {\n                        imageResource.width = alignedWidth;\n                        imageResource.height = alignedHeight;\n                    }\n\n                    const imageBuffer = new Uint8Array(byteSize);\n\n                    if (!basisFile.transcodeImage(imageBuffer, i, 0, format, false, false))\n                    {\n                        if (fallbackMode)\n                        {\n                            // We failed in fallback mode as well!\n                            console.error(`Basis failed to transcode image ${i}, level ${0}!`);\n\n                            return { type: 'transcode', requestID: message.requestID, success: false };\n                        }\n\n                        /* eslint-disable-next-line max-len */\n                        console.warn(`Basis failed to transcode image ${i}, level ${0}! Retrying to an uncompressed texture format!`);\n                        i = -1;\n                        fallbackMode = true;\n\n                        break;\n                    }\n\n                    imageResource.levelArray.push({\n                        levelID: j,\n                        levelWidth: width,\n                        levelHeight: height,\n                        levelBuffer: imageBuffer\n                    });\n                }\n\n                imageArray[i] = imageResource;\n            }\n\n            basisFile.close();\n            basisFile.delete();\n\n            return {\n                type: 'transcode',\n                requestID: message.requestID,\n                success: true,\n                basisFormat: !fallbackMode ? basisFormat : basisFallbackFormat,\n                imageArray\n            };\n        }\n    };\n\n    self.onmessage = (e: { data: Partial<IInitializeTranscoderMessage | ITranscodeMessage> }): void =>\n    {\n        const msg = e.data;\n        const response = messageHandlers[msg.type](msg as any);\n\n        if (response)\n        {\n            (self as any).postMessage(response);\n        }\n    };\n}\n","import { Runner } from '@pixi/runner';\nimport { BASIS_FORMATS } from './Basis';\nimport { ITranscodeResponse, TranscoderWorkerWrapper } from './TranscoderWorkerWrapper';\n\n/**\n * Worker class for transcoding *.basis files in background threads.\n *\n * To enable asynchronous transcoding, you need to provide the URL to the basis_universal transcoding\n * library.\n *\n * @memberof PIXI.BasisLoader\n */\nexport class TranscoderWorker\n{\n    // IMPLEMENTATION NOTE: TranscoderWorker tracks transcoding requests with a requestID; the worker can be issued\n    // multiple requests (once it is initialized) and the response contains the requestID of the triggering request. Based on\n    // the response, the transcodeAsync promise is fulfilled or rejected.\n\n    // TODO: Publish our own @pixi/basis package & set default URL to jsdelivr/cdnjs\n    /**\n     * URL for the script containing the basis_universal library.\n     */\n    static bindingURL: string;\n    static jsSource: string;\n    static wasmSource: ArrayBuffer;\n\n    public static onTranscoderInitialized = new Runner('onTranscoderInitialized');\n\n    isInit: boolean;\n    load: number;\n    requests: { [id: number]: {\n        resolve: (data: ITranscodeResponse) => void,\n        reject: () => void\n    } } = {};\n\n    private static _workerURL: string;\n    private static _tempID = 0;\n\n    /**\n     * Generated URL for the transcoder worker script.\n     */\n    static get workerURL(): string\n    {\n        if (!TranscoderWorker._workerURL)\n        {\n            let workerSource = TranscoderWorkerWrapper.toString();\n\n            const beginIndex = workerSource.indexOf('{');\n            const endIndex = workerSource.lastIndexOf('}');\n\n            workerSource = workerSource.slice(beginIndex + 1, endIndex);\n\n            if (TranscoderWorker.jsSource)\n            {\n                workerSource = `${TranscoderWorker.jsSource}\\n${workerSource}`;\n            }\n\n            TranscoderWorker._workerURL = URL.createObjectURL(new Blob([workerSource]));\n        }\n\n        return TranscoderWorker._workerURL;\n    }\n\n    protected worker: Worker;\n    protected initPromise: Promise<void>;\n    protected onInit: () => void;\n\n    constructor()\n    {\n        this.isInit = false;\n        this.load = 0;\n        this.initPromise = new Promise((resolve) => { this.onInit = resolve; });\n\n        if (!TranscoderWorker.wasmSource)\n        {\n            console.warn('PIXI.resources.BasisResource.TranscoderWorker has not been given the transcoder WASM binary!');\n        }\n\n        this.worker = new Worker(TranscoderWorker.workerURL);\n        this.worker.onmessage = this.onMessage;\n        this.worker.postMessage({\n            type: 'init',\n            jsSource: TranscoderWorker.jsSource,\n            wasmSource: TranscoderWorker.wasmSource\n        });\n    }\n\n    /**\n     * @returns a promise that is resolved when the web-worker is initialized\n     */\n    initAsync(): Promise<void>\n    {\n        return this.initPromise;\n    }\n\n    /**\n     * @param basisData - *.basis file contents\n     * @param rgbaFormat - transcoding format for RGBA files\n     * @param rgbFormat - transcoding format for RGB files\n     * @returns a promise that is resolved with the transcoding response of the web-worker\n     */\n    async transcodeAsync(\n        basisData: Uint8Array,\n        rgbaFormat: BASIS_FORMATS,\n        rgbFormat: BASIS_FORMATS\n    ): Promise<ITranscodeResponse>\n    {\n        ++this.load;\n\n        const requestID = TranscoderWorker._tempID++;\n        const requestPromise = new Promise((resolve: (data: ITranscodeResponse) => void, reject: () => void) =>\n        {\n            this.requests[requestID] = {\n                resolve,\n                reject\n            };\n        });\n\n        this.worker.postMessage({\n            requestID,\n            basisData,\n            rgbaFormat,\n            rgbFormat,\n            type: 'transcode'\n        });\n\n        return requestPromise;\n    }\n\n    /**\n     * Handles responses from the web-worker\n     *\n     * @param e\n     */\n    protected onMessage = (e: MessageEvent): void =>\n    {\n        const data = e.data as ITranscodeResponse;\n\n        if (data.type === 'init')\n        {\n            if (!data.success)\n            {\n                throw new Error('BasisResource.TranscoderWorker failed to initialize.');\n            }\n\n            this.isInit = true;\n            this.onInit();\n        }\n        else if (data.type === 'transcode')\n        {\n            --this.load;\n\n            const requestID = data.requestID;\n\n            if (data.success)\n            {\n                this.requests[requestID].resolve(data);\n            }\n            else\n            {\n                this.requests[requestID].reject();\n            }\n\n            delete this.requests[requestID];\n        }\n    };\n\n    /**\n     * Loads the transcoder source code\n     *\n     * @param jsURL\n     * @param wasmURL\n     */\n    static loadTranscoder(jsURL: string, wasmURL: string): Promise<[void, void]>\n    {\n        const jsPromise = fetch(jsURL)\n            .then((res: Response) => res.text())\n            .then((text: string) => { TranscoderWorker.jsSource = text; });\n        const wasmPromise = fetch(wasmURL)\n            .then((res: Response) => res.arrayBuffer())\n            .then((arrayBuffer: ArrayBuffer) => { TranscoderWorker.wasmSource = arrayBuffer; });\n\n        return Promise.all([jsPromise, wasmPromise]).then((data) =>\n        {\n            TranscoderWorker.onTranscoderInitialized.emit();\n\n            return data;\n        });\n    }\n\n    /**\n     * Set the transcoder source code directly\n     *\n     * @param jsSource\n     * @param wasmSource\n     */\n    static setTranscoder(jsSource: string, wasmSource: ArrayBuffer): void\n    {\n        TranscoderWorker.jsSource = jsSource;\n        TranscoderWorker.wasmSource = wasmSource;\n    }\n}\n","import { TYPES, MIPMAP_MODES, ALPHA_MODES, FORMATS } from '@pixi/constants';\nimport { BaseTexture, BufferResource, Texture } from '@pixi/core';\nimport { CompressedTextureResource, INTERNAL_FORMATS } from '@pixi/compressed-textures';\nimport {\n    BASIS_FORMATS,\n    BASIS_FORMAT_TO_INTERNAL_FORMAT,\n    INTERNAL_FORMAT_TO_BASIS_FORMAT,\n    BASIS_FORMATS_ALPHA,\n    BasisTextureExtensions,\n    BasisBinding,\n    BASIS_FORMAT_TO_TYPE\n} from './Basis';\nimport { TranscoderWorker } from './TranscoderWorker';\nimport { ILoaderResource, LoaderResource } from '@pixi/loaders';\n\ntype TranscodedResourcesArray = (Array<CompressedTextureResource> | Array<BufferResource>) & {\n    basisFormat: BASIS_FORMATS\n};\n\nLoaderResource.setExtensionXhrType('basis', LoaderResource.XHR_RESPONSE_TYPE.BUFFER);\n\n/**\n * Loader plugin for handling BASIS supercompressed texture files.\n *\n * To use this loader, you must bind the basis_universal WebAssembly transcoder. There are two ways of\n * doing this:\n *\n * 1. Adding a &lt;script&gt; tag to your HTML page to the transcoder bundle in this package, and serving\n * the WASM binary from the same location.\n *\n * ```js\n * // Copy ./node_modules/@pixi/basis/assets/basis_.wasm into your assets directory\n * // as well, so it is served from the same folder as the JavaScript!\n * &lt;script src=\"./node_modules/@pixi/basis/assets/basis_transcoder.js\" /&gt;\n * ```\n *\n * NOTE: `basis_transcoder.js` expects the WebAssembly binary to be named `basis_transcoder.wasm`.\n * NOTE-2: This method supports transcoding on the main-thread. Only use this if you have 1 or 2 *.basis\n * files.\n *\n * 2. Loading the transcoder source from a URL.\n *\n * ```js\n * // Use this if you to use the default CDN url for @pixi/basis\n * BasisLoader.loadTranscoder();\n *\n * // Use this if you want to serve the transcoder on your own\n * BasisLoader.loadTranscoder('./basis_transcoder.js', './basis_transcoder.wasm');\n * ```\n *\n * NOTE: This can only be used with web-workers.\n *\n * @class\n * @memberof PIXI\n * @implements PIXI.ILoaderPlugin\n */\nexport class BasisLoader\n{\n    private static basisBinding: BasisBinding;\n    private static defaultRGBFormat: { basisFormat: BASIS_FORMATS, textureFormat: INTERNAL_FORMATS | TYPES };\n    private static defaultRGBAFormat: { basisFormat: BASIS_FORMATS, textureFormat: INTERNAL_FORMATS | TYPES };\n    private static fallbackMode = false;\n    private static workerPool: TranscoderWorker[] = [];\n\n    /**\n     * Transcodes the *.basis data when the data is loaded. If the transcoder is not bound yet, it\n     * will hook transcoding to {@link BasisResource#onTranscoderInitialized}.\n     *\n     * @param resource\n     * @param next\n     */\n    public static use(resource: ILoaderResource, next: (...args: any[]) => void): void\n    {\n        if (resource.extension === 'basis' && resource.data)\n        {\n            if (!!BasisLoader.basisBinding || (!!BasisLoader.TranscoderWorker.wasmSource))\n            {\n                BasisLoader.transcode(resource, next);\n            }\n            else\n            {\n                TranscoderWorker.onTranscoderInitialized.add(() =>\n                {\n                    BasisLoader.transcode(resource, next);\n                });\n            }\n        }\n        else\n        {\n            next();\n        }\n    }\n\n    /**\n     * Runs transcoding and populates {@link imageArray}. It will run the transcoding in a web worker\n     * if they are available.\n     *\n     * @private\n     */\n    private static async transcode(resource: ILoaderResource, next: (...args: any[]) => void): Promise<void>\n    {\n        const data = resource.data;\n\n        let resources: TranscodedResourcesArray;\n\n        if (typeof Worker !== 'undefined' && BasisLoader.TranscoderWorker.wasmSource)\n        {\n            resources = await BasisLoader.transcodeAsync(data as ArrayBuffer);\n        }\n        else\n        {\n            resources = BasisLoader.transcodeSync(data as ArrayBuffer);\n        }\n\n        BasisLoader.registerTextures(resource.url, resources);\n\n        next();\n    }\n\n    /**\n     * @param {string} url\n     * @param {TranscodedResourcesArray} resources\n     * @private\n     */\n    private static registerTextures(url: string, resources: TranscodedResourcesArray): void\n    {\n        if (!resources)\n        {\n            return;\n        }\n\n        // Should be a valid TYPES, FORMATS for uncompressed basis formats\n        const type: TYPES = BASIS_FORMAT_TO_TYPE[resources.basisFormat];\n        const format: FORMATS = resources.basisFormat !== BASIS_FORMATS.cTFRGBA32 ? FORMATS.RGB : FORMATS.RGBA;\n\n        resources.forEach((resource, i) =>\n        {\n            const baseTexture = new BaseTexture(resource, {\n                mipmap: MIPMAP_MODES.OFF,\n                alphaMode: ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,\n                type,\n                format\n            });\n            const cacheID = `${url}-${i + 1}`;\n\n            BaseTexture.addToCache(baseTexture, cacheID);\n            Texture.addToCache(new Texture(baseTexture), cacheID);\n\n            if (i === 0)\n            {\n                BaseTexture.addToCache(baseTexture, url);\n                Texture.addToCache(new Texture(baseTexture), url);\n            }\n        });\n    }\n\n    /**\n     * Finds a suitable worker for transcoding and sends a transcoding request\n     *\n     * @private\n     * @async\n     */\n    private static async transcodeAsync(arrayBuffer: ArrayBuffer): Promise<TranscodedResourcesArray>\n    {\n        const workerPool = BasisLoader.workerPool;\n\n        let leastLoad = 0x10000000;\n        let worker = null;\n\n        for (let i = 0, j = workerPool.length; i < j; i++)\n        {\n            if (workerPool[i].load < leastLoad)\n            {\n                worker = workerPool[i];\n                leastLoad = worker.load;\n            }\n        }\n\n        if (!worker)\n        {\n            /* eslint-disable-next-line no-use-before-define */\n            worker = new TranscoderWorker();\n\n            workerPool.push(worker);\n        }\n\n        // Wait until worker is ready\n        await worker.initAsync();\n\n        const response = await worker.transcodeAsync(\n            new Uint8Array(arrayBuffer),\n            BasisLoader.defaultRGBAFormat.basisFormat,\n            BasisLoader.defaultRGBFormat.basisFormat\n        );\n\n        const basisFormat = response.basisFormat;\n        const imageArray = response.imageArray;\n\n        // whether it is an uncompressed format\n        const fallbackMode = basisFormat > 12;\n        let imageResources: TranscodedResourcesArray;\n\n        if (!fallbackMode)\n        {\n            const format = BASIS_FORMAT_TO_INTERNAL_FORMAT[response.basisFormat];\n\n            // HINT: this.imageArray is CompressedTextureResource[]\n            imageResources = new Array<CompressedTextureResource>(imageArray.length) as TranscodedResourcesArray;\n\n            for (let i = 0, j = imageArray.length; i < j; i++)\n            {\n                imageResources[i] = new CompressedTextureResource(null, {\n                    format,\n                    width: imageArray[i].width,\n                    height: imageArray[i].height,\n                    levelBuffers: imageArray[i].levelArray,\n                    levels: imageArray[i].levelArray.length\n                });\n            }\n        }\n        else\n        {\n            // TODO: BufferResource does not support manual mipmapping.\n            imageResources = imageArray.map((image) => new BufferResource(\n                new Uint16Array(image.levelArray[0].levelBuffer.buffer), {\n                    width: image.width,\n                    height: image.height\n                })\n            ) as TranscodedResourcesArray;\n        }\n\n        imageResources.basisFormat = basisFormat;\n\n        return imageResources;\n    }\n\n    /**\n     * Runs transcoding on the main thread.\n     *\n     * @private\n     */\n    private static transcodeSync(arrayBuffer: ArrayBuffer): TranscodedResourcesArray\n    {\n        const BASIS = BasisLoader.basisBinding;\n\n        const data = new Uint8Array(arrayBuffer);\n        const basisFile = new BASIS.BasisFile(data);\n        const imageCount = basisFile.getNumImages();\n        const hasAlpha = basisFile.getHasAlpha();\n\n        const basisFormat = hasAlpha\n            ? BasisLoader.defaultRGBAFormat.basisFormat\n            : BasisLoader.defaultRGBFormat.basisFormat;\n        const basisFallbackFormat = BASIS_FORMATS.cTFRGB565;\n        const imageResources = new Array<CompressedTextureResource | BufferResource>(imageCount);\n\n        let fallbackMode = BasisLoader.fallbackMode;\n\n        if (!basisFile.startTranscoding())\n        {\n            console.error(`Basis failed to start transcoding!`);\n\n            basisFile.close();\n            basisFile.delete();\n\n            return null;\n        }\n\n        for (let i = 0; i < imageCount; i++)\n        {\n            // Don't transcode all mipmap levels in fallback mode!\n            const levels = !fallbackMode ? basisFile.getNumLevels(i) : 1;\n            const width = basisFile.getImageWidth(i, 0);\n            const height = basisFile.getImageHeight(i, 0);\n            const alignedWidth = (width + 3) & ~3;\n            const alignedHeight = (height + 3) & ~3;\n\n            const imageLevels = new Array<{ levelBuffer: Uint8Array, levelWidth: number, levelHeight: number}>(levels);\n\n            // Transcode mipmap levels into \"imageLevels\"\n            for (let j = 0; j < levels; j++)\n            {\n                const levelWidth = basisFile.getImageWidth(i, j);\n                const levelHeight = basisFile.getImageHeight(i, j);\n                const byteSize = basisFile.getImageTranscodedSizeInBytes(\n                    i, 0, !fallbackMode ? basisFormat : basisFallbackFormat);\n\n                imageLevels[j] = {\n                    levelBuffer: new Uint8Array(byteSize),\n                    levelWidth,\n                    levelHeight,\n                };\n\n                if (!basisFile.transcodeImage(\n                    imageLevels[j].levelBuffer, i, 0, !fallbackMode ? basisFormat : basisFallbackFormat, false, false))\n                {\n                    if (fallbackMode)\n                    {\n                        console.error(`Basis failed to transcode image ${i}, level ${0}!`);\n                        break;\n                    }\n                    else\n                    {\n                        // Try transcoding to an uncompressed format before giving up!\n                        // NOTE: We must start all over again as all Resources must be in compressed OR uncompressed.\n                        i = -1;\n                        fallbackMode = true;\n\n                        /* eslint-disable-next-line max-len */\n                        console.warn(`Basis failed to transcode image ${i}, level ${0} to a compressed texture format. Retrying to an uncompressed fallback format!`);\n                        continue;\n                    }\n                }\n            }\n\n            let imageResource;\n\n            if (!fallbackMode)\n            {\n                imageResource = new CompressedTextureResource(null, {\n                    format: BASIS_FORMAT_TO_INTERNAL_FORMAT[basisFormat],\n                    width: alignedWidth,\n                    height: alignedHeight,\n                    levelBuffers: imageLevels,\n                    levels\n                });\n            }\n            else\n            {\n                // TODO: BufferResource doesn't support manual mipmap levels\n                imageResource = new BufferResource(\n                    new Uint16Array(imageLevels[0].levelBuffer.buffer), { width, height });\n            }\n\n            imageResources[i] = imageResource;\n        }\n\n        basisFile.close();\n        basisFile.delete();\n\n        const transcodedResources = imageResources as TranscodedResourcesArray;\n\n        transcodedResources.basisFormat = !fallbackMode ? basisFormat : basisFallbackFormat;\n\n        return transcodedResources;\n    }\n\n    /**\n     * Detects the available compressed texture formats on the device.\n     *\n     * @param extensions - extensions provided by a WebGL context\n     * @ignore\n     */\n    static autoDetectFormats(extensions?: Partial<BasisTextureExtensions>): void\n    {\n        // Auto-detect WebGL compressed-texture extensions\n        if (!extensions)\n        {\n            const canvas = document.createElement('canvas');\n            const gl = canvas.getContext('webgl');\n\n            if (!gl)\n            {\n                console.error('WebGL not available for BASIS transcoding. Silently failing.');\n\n                return;\n            }\n\n            extensions = {\n                s3tc: gl.getExtension('WEBGL_compressed_texture_s3tc'),\n                s3tc_sRGB: gl.getExtension('WEBGL_compressed_texture_s3tc_srgb'), /* eslint-disable-line camelcase */\n                etc: gl.getExtension('WEBGL_compressed_texture_etc'),\n                etc1: gl.getExtension('WEBGL_compressed_texture_etc1'),\n                pvrtc: gl.getExtension('WEBGL_compressed_texture_pvrtc')\n                    || gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc'),\n                atc: gl.getExtension('WEBGL_compressed_texture_atc'),\n                astc: gl.getExtension('WEBGL_compressed_texture_astc')\n            };\n        }\n\n        // Discover the available texture formats\n        const supportedFormats: { [id: string]: INTERNAL_FORMATS } = {};\n\n        for (const key in extensions)\n        {\n            const extension = (extensions as any)[key];\n\n            if (!extension)\n            {\n                continue;\n            }\n\n            Object.assign(supportedFormats, Object.getPrototypeOf(extension));\n        }\n\n        // Set the default alpha/non-alpha output formats for basisu transcoding\n        for (let i = 0; i < 2; i++)\n        {\n            const detectWithAlpha = !!i;\n            let internalFormat: number;\n            let basisFormat: number;\n\n            for (const id in supportedFormats)\n            {\n                internalFormat = supportedFormats[id];\n                basisFormat = INTERNAL_FORMAT_TO_BASIS_FORMAT[internalFormat];\n\n                if (basisFormat !== undefined)\n                {\n                    if ((detectWithAlpha && BASIS_FORMATS_ALPHA[basisFormat])\n                        || (!detectWithAlpha && !BASIS_FORMATS_ALPHA[basisFormat]))\n                    {\n                        break;\n                    }\n                }\n            }\n\n            if (internalFormat)\n            {\n                BasisLoader[detectWithAlpha ? 'defaultRGBAFormat' : 'defaultRGBFormat'] = {\n                    textureFormat: internalFormat,\n                    basisFormat,\n                };\n            }\n            else\n            {\n                BasisLoader[detectWithAlpha ? 'defaultRGBAFormat' : 'defaultRGBFormat'] = {\n                    textureFormat: TYPES.UNSIGNED_SHORT_5_6_5,\n                    basisFormat: BASIS_FORMATS.cTFRGB565\n                };\n\n                BasisLoader.fallbackMode = true;\n            }\n        }\n    }\n\n    /**\n     * Binds the basis_universal transcoder to decompress *.basis files. You must initialize the transcoder library yourself.\n     *\n     * ```js\n     * import { BasisLoader } from '@pixi/basis';\n     * import { Loader } from '@pixi/loaders';\n     *\n     * // window.BASIS() returns a Promise-like object\n     * window.BASIS().then((basisLibrary) =>\n     * {\n     *     // Initialize basis-library; otherwise, transcoded results maybe corrupt!\n     *     basisLibrary.initializeBasis();\n     *\n     *     // Bind BasisLoader to the transcoder\n     *     BasisLoader.bindTranscoder(basisLibrary);\n     * });\n     * ```\n     *\n     * @param basisu - the initialized transcoder library\n     * @private\n     */\n    static bindTranscoder(basisLibrary: BasisBinding): void\n    {\n        BasisLoader.basisBinding = basisLibrary;\n    }\n\n    /**\n     * Loads the transcoder source code for use in {@link PIXI.BasisLoader.TranscoderWorker}.\n     *\n     * @param jsURL\n     * @param wasmURL\n     * @private\n     */\n    static loadTranscoder(jsURL: string, wasmURL: string): Promise<[void, void]>\n    {\n        return BasisLoader.TranscoderWorker.loadTranscoder(jsURL, wasmURL);\n    }\n\n    /**\n     * Set the transcoder source code directly\n     *\n     * @param jsSource\n     * @param wasmSource\n     * @private\n     */\n    static setTranscoder(jsSource: string, wasmSource: ArrayBuffer): void\n    {\n        BasisLoader.TranscoderWorker.setTranscoder(jsSource, wasmSource);\n    }\n\n    static TranscoderWorker: typeof TranscoderWorker = TranscoderWorker;\n\n    static get TRANSCODER_WORKER_POOL_LIMIT(): number\n    {\n        return this.workerPool.length || 1;\n    }\n\n    static set TRANSCODER_WORKER_POOL_LIMIT(limit: number)\n    {\n        // TODO: Destroy workers?\n        for (let i = this.workerPool.length; i < limit; i++)\n        {\n            this.workerPool[i] = new TranscoderWorker();\n            this.workerPool[i].initAsync();\n        }\n    }\n}\n\n// Auto-detect compressed texture formats once @pixi/basis is imported!\nBasisLoader.autoDetectFormats();\n","import { Loader } from '@pixi/loaders';\nimport { BasisLoader } from './BasisLoader';\n\nexport * from './Basis';\nexport * from './BasisLoader';\n\n// parse any BASIS supercompressed files into textures\nLoader.registerPlugin(BasisLoader);\n"],"names":["BASIS_FORMATS","INTERNAL_FORMATS","TYPES","Runner","LoaderResource","FORMATS","BaseTexture","MIPMAP_MODES","ALPHA_MODES","Texture","CompressedTextureResource","BufferResource","Loader"],"mappings":"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"}